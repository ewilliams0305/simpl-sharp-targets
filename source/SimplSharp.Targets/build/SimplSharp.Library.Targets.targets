<?xml version="1.0" encoding="UTF-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0">

  <Target Name="SimplSharpClean"/>
  <Target Name="SimplSharpPostProcess47"/>
  <Target Name="SimplSharpPostProcess"/>

  <PropertyGroup>
    <ProduceReferenceAssembly>False</ProduceReferenceAssembly>
    <CopyLocalLockFileAssemblies>False</CopyLocalLockFileAssemblies>
  </PropertyGroup>

  <!-- Data Variables -->

  <PropertyGroup>
    <ToolCommand>dotnet simplsharp clz</ToolCommand>
    <ToolVersion>0.1.3</ToolVersion>
    <ArchiveExtension>.clz</ArchiveExtension>
  </PropertyGroup>

  <!-- Output Provided -->

  <PropertyGroup>
    <IsCustomOutputPath Condition="'$(OutputPath)' != '$(BaseOutputPath)bin\$(Configuration)\'">true</IsCustomOutputPath>
  </PropertyGroup>

  <!-- Clean Up -->

  <Target Name="SimplSharpCleanup" AfterTargets="BeforeBuild;AfterClean">
    <Delete Files="$(OutputPath)\ProgramInfo.config" ContinueOnError="true" />
    <Delete Files="$(OutputPath)\$(TargetName)$(ArchiveExtension)" ContinueOnError="true" />
  </Target>

  <!-- Installation -->

  <Target Name="InstallTools" BeforeTargets="SimplSharpBuildArchive">
    <Message Importance="high" Text="Checking for SimplSharp.Tool updates $(ToolVersion)" />
    <Exec Command="dotnet tool install SimplSharp.Tool --version $(ToolVersion) --create-manifest-if-needed --allow-downgrade" />
  </Target>

  <!-- Execute Actions -->
  
  <Target Name="SimplSharpBuildArchive" BeforeTargets="AfterBuild">
    <Message Importance="high" Text="----> Creating SIMPL Sharp Archive $(OutputPath)\$(AssemblyName).dll ----> $(OutputPath)" Condition="'$(IsCustomOutputPath)' == 'true'"/>
    <Exec Command="$(ToolCommand) -p $(OutputPath)\$(AssemblyName).dll -d $(OutputPath)" Condition="'$(IsCustomOutputPath)' == 'true'" />

    <Message Importance="high" Text="----> Creating SIMPL Sharp Archive $(MSBuildProjectDirectory)\$(OutputPath)$(AssemblyName).dll ----> $(MSBuildProjectDirectory)\$(OutputPath)" Condition="'$(IsCustomOutputPath)' != 'true'"/>
    <Exec Command="$(ToolCommand) -p $(MSBuildProjectDirectory)\$(OutputPath)$(AssemblyName).dll" Condition="'$(IsCustomOutputPath)' != 'true'" />
  </Target>

</Project>